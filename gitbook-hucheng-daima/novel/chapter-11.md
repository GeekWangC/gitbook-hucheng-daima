# 第十一章 影子系统

迁移不是按下开关那么简单。影子系统像城市地下的管廊：新的路线沿着旧的脉络铺设，旧的仍在运行，新的已经通电。

他们决定采用“双写—对比—切换”的策略：

- 双写：在关键链路同时写入新旧系统；
- 对比：以可观测的指标（成功率、延迟、错误类型）比较差异；
- 切换：在小范围内先引入新系统的“主路权”。

“我们先别争论哪一个‘更好’。”陈砺说，“先把‘差异’写出来。”

第一周，影子系统的 P95 延迟略高，但错误率更低。第二周，延迟回落，错误率持平。第三周，小范围切换成功。

也有意外。有一次，一个看似无害的“默认值”导致了缓存穿透。追踪图上出现了一道细细的长线，把整个瀑布拉得很长。十分钟后，回退开关拉起。复盘时，他们在 ADR 的“教训”一栏写下：

“默认不是‘偷懒’，是‘负责任’。”

走廊的墙上，影子系统的旅程图被贴成一张海报。路口用不同的颜色标出“新/旧/双写”。很多人路过会停一下，给某个路口加一条注释。这个习惯让迁移变得不那么可怕。人们不再害怕“旧路”，也不迷信“新路”。

“我们要会走两种路。”江牧说。