# 第二十二章 安全左移

雨后的地砖反着光，像刚擦过的屏幕。保安在大楼门口擦拭识别器外壳，一点不紧不慢。陈砺想起了他们要做的事——把“默认即安全”真正写进流程，而不是写在墙上。

他们用一个简单的表拉开了这章的帷幕：

- SAST：静态代码扫描，提交即触发；
- DAST：动态攻击模拟，预发即跑；
- 依赖审计：锁文件变化即告警；
- CSP：内容安全策略，默认最小化；
- 威胁建模：每一项重大变更前的桌面演练。

桌面演练那天，会议室里摆着便签、卡片和一张写着“对手是谁”的空白格子。

“对手不是人。”江牧说，“对手是我们没看见的路径。”

他们把系统当作一栋老房子，从门窗到地基，从庭院到电线，沿着“攻击者视角”走了一遍。每走一步，就问三个问题：

1. 如果我是攻击者，我会从哪儿试？
2. 如果被我试进去了，谁先知道？
3. 知道之后，我能把损失控制在哪里？

一圈下来，白板上出现了两类卡片：红色的“立即关闭口子”，蓝色的“默认即安全”。

“默认即安全”意味着不依赖提醒，而是把危险的路一开始就关掉：

- 表单提交默认不信任 HTML 输入；
- 第三方脚本默认被沙盒隔离、只允许必要权限；
- Token 默认短时、可撤销，权限按最小原则配置；
- 构建环节默认跑依赖审计，升级路径被写成 ADR；
- 预发默认开启 DAST，所有对外接口都挂上速率限制。

“左移不是把责任扔给开发。”陈砺说，“左移是把信任放在最前面，通过默认选项让安全成为容易的事。”

一周后，他们做了第一次“安全快走”。不像演讲，更像遛弯。每走到一个系统入口，就停下来看三十秒，问一句：“如果在这里被诱导，用户会怎么走？”他们把每一次“可能的诱导”贴成一条小路，标上“可疑”的路标。到傍晚，白板被贴得像一张旧城改造图。

“这张图要每周更新。”江牧说，“安全不是一次改造，而是持续的维护。”

他们把安全的评分卡并到发布闸门里：没有通过 SAST/DAST，就不能通过构建；依赖审计有高危，就把发布票自动转到红色轨道；CSP 默认严格，放宽必须有 ADR 记录并标注“到期再议”。

第一次严格执行的那天，发布延迟了两个小时。有人抱怨：

“太慢了。”

“不。”陈砺说，“今天的慢，是为了明天的快。”

第二周，延迟下降到二十分钟；第三周，十分钟；第四周，回到了正常发布窗口之内。没有人再抱怨。大家只是把“默认即安全”四个字写进了记忆，像把门口的台阶记在脚上。

有一次，小齐在预发环境被 DAST 扫出一个开放的调试端点。他没有在群里喊，而是把三句事实贴到白板上：

1. 我看见预发存在 /debug 端点；
2. 我期待预发不对外暴露调试端点；
3. 差异在于我们忽略了默认配置的继承。

十分钟后，端点被关闭，配置被修复，ADR 记录写上“到期复议：三个月后评估是否仍需该配置”。

“桌面演练”的最后一场，他们让每个人扮演一个“攻击者”。角色不叫黑客，而叫“路径”。路径 A 是钓鱼邮件，路径 B 是依赖投毒，路径 C 是跨站脚本。每条路径都不复杂，却足以造成麻烦。他们一个个演绎，像在下慢棋。棋盘上偶有失误，但每一次失误都被记录、修复、传承。

“安全是慢变量。”江牧总结，“它不会让你明天早上醒来就多了十万用户，但它会让你后天晚上睡得更踏实。”

傍晚，雨又落下来。陈砺撑着伞，在大楼门口停了一下。保安仍在擦识别器外壳。他忽然觉得，所谓“安全左移”，就是把擦拭的动作换到了更早、更常、更安静的时刻。

他收起伞，往地铁站走去。地下通道里，有一面旧旧的墙，上面贴满了宣传贴纸，其中一张写着：请不要相信“轻松赚钱”。他笑了笑。世界一直在提醒我们：默认即安全。

下一个月，他们把“默认即安全”做成了“策略表”。不是长篇文档，而是可以快速检索的决策网：

- 输入来源：用户/脚本/第三方 → 验证等级：弱/中/强；
- 资源加载：同源/跨源 → 沙盒：开/关；
- 权限请求：摄像头/剪贴板/位置 → 默认：拒绝/按需；
- 错误处理：系统/业务/网络 → 回退路径：A/B/C；
- 报警阈值：静默/提示/强制 → 通知对象：广播员/值守/全员。

策略表不在 Wiki，而在每个仓库的 /security 目录下，跟代码一起被版本化。任何更改都需要一个小小的 ADR，把“为什么”和“到何时复议”写清楚。

他们还做了三次不同角色的桌面演练：

1. 作为产品：在“增加转化”的压力下，如何不放松 CSP 与权限；
2. 作为前端：在“快速验证”的需求下，如何不把调试端点带进预发；
3. 作为运营：在“活动大促”的背景下，如何识别并拒绝“来路不明”的脚本。

每一次演练的最后，都要写一条“最小对策”：一个改动、一行脚本、一个门槛。比如，他们把“复制到剪贴板”的默认行为换成了“明确触发”，把“第三方脚本”的加载改成了“延后与隔离”，把“异常提示”的语言从“抱歉”换成了“我们已经收到”。

这些改动在数据上不惊人。可一周后，客服里关于“莫名其妙弹窗”的投诉下降了 40%，用户的“惊吓感”不再被反复提及。安全并没有把速度拖慢，它只是把速度放在了更稳的轨道上。

“我们不是在建墙。”陈砺说，“我们在修路。”

夜里，他们在走廊里贴上了一份新的“值守表”：谁在监控 SAST 报告，谁在关注 DAST 报告，谁在处理依赖告警。值守像接力，棒棒相传。每一次交接，都要说一句：

“今天没有异常。”

如果有，那就写事实。

冬天的风更冷了。大楼门口的识别器照常被擦拭。保安抬头冲他笑，像是在说：别担心，今天也很安全。

又过了几天，CSP 报告寄来一封“信”。那是一封自动汇总的日报，标题没有惊悚，只写：“我们今天挡住了 137 次不合规脚本。”他们把这封“信”贴在知识墙上，作为“无声的功劳簿”。墙下放了一支笔，任何人路过可以在旁边写一句注释：

“第 42 次来自老版本页面，已合并修复。”

“第 89 次为测试误触，已在 CI 中补充白名单校验。”

“第 120 次来源不明，已转红色轨道跟踪。”

晚上散会时，大家照例路过那面墙。有人会停一秒，有人会轻轻点一下那张日报，像给今天的秩序行了一礼。

“所谓安全左移，不是为了多一张墙。”陈砺最后说，“而是为了少一些夜里醒来的心跳。”

他收起电脑，走进寒意更浓的夜。高架桥下车辆不断，远远的，有救护车的鸣笛掠过。城市有它自己的报警系统，克制而有效。他忽然想到，真正的安全并不是没有风险，而是风险被看见、被记录、被温柔地引导到更不伤人的地方。
他把围巾往上提了提，嘴里呼出一小团白气。那团白气在路灯下迅速散开，像一条被及时放掉的压力曲线。
